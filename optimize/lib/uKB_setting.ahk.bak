#Requires AutoHotkey v2.0

#SingleInstance force ;只允许单个该脚本运行,脚本强制替换
A_HotkeyModifierTimeout := 0  ;影响热键修饰符的行为：CTRL、ALT、WIN 和 SHIFT。设为 0 时则总是超时 (修饰键总是不会被推回到按下的状态).
ProcessSetPriority "High"  ;脚本进程优先级为高

;确保在执行脚本时，这些键被按下，模拟为释放状态，避免干扰脚本接下来的操作。
SendMode "Input" ;使 Send 等同于 SendEvent 或 SendPlay, 而不是默认的(SendInput).
Send "{Alt Up}{Ctrl Up}{Shift Up}{LWin Up}{RWin Up}{CapsLock Up}"

; 提高权限并重启脚本（如果必要）
full_command_line := DllCall("GetCommandLine", "str")
if not (A_IsAdmin or RegExMatch(full_command_line, " /restart(?!\\S)"))
{
    try
    {
        if A_IsCompiled
            Run '*RunAs "' A_ScriptFullPath '" /restart'
        else
            Run '*RunAs "' A_AhkPath '" /restart "' A_ScriptFullPath '"'
    }
    ExitApp
}

; 全局设置
GLOBAL DEBUGMODE := true  ; 调试模式开关
GLOBAL TICKRATE := 20     ; 设置适合大多数操作的内部逻辑刷新率
GLOBAL DoubleClickInterval := 70 ; 定义双击间隔时间，单位毫秒
GLOBAL LastPressTime := 0


;{定义窗口组

;各种保存窗口类型1（注意不是另存为窗口），特点：有3个选项：是（默认，回车、s、y）、否（n）、取消（esc）
GroupAdd savebox1 Microsoft Office ahk_class #32770   ;…………………Microsoft Office 03/07版保存窗口
GroupAdd savebox1 Microsoft ahk_class NUIDialog   ;………………………Microsoft Office 2010版保存窗口
GroupAdd savebox1, Microsoft Word ahk_class #32770   ;…………………word 2010版关闭时剪贴板含有大量数据
GroupAdd savebox1, Microsoft Excel ahk_class #32770 ,在剪贴板上有大量信息 ;excel 2010版关闭时剪贴板含有大量数据
GroupAdd savebox1, Notepad2 ahk_class #32770,保存   ;……………notepad2保存窗口
GroupAdd savebox1, 记事本 ahk_class #32770,保存   ;……………记事本保存窗口
GroupAdd savebox1, SciTE ahk_class #32770 ;…………………scite保存窗口
GroupAdd savebox1, EmEditor ahk_class #32770 ;…………………EmEditor保存窗口
GroupAdd savebox1, EverEdit ahk_class #32770 ;…………………EverEdit保存窗口
GroupAdd savebox1, Imagine ahk_class #32770    ;……TC图片预览最后一张时弹出的界面
GroupAdd savebox1, Total Commander ahk_class #32770 ,此标签已被锁定 ;tc关闭锁定标签
GroupAdd savebox1, TdxW ahk_class #32770      ;……………………通达信关闭后提示是否下载数据
GroupAdd savebox1, 福昕阅读器 ahk_class #32770      ;……………………pdf福昕阅读器保存窗口
GroupAdd savebox1, Save ahk_class #32770      ;……………………notepad++保存窗口
GroupAdd savebox1, ahk_class QWidget    ;……………………WPS保存窗口

;各种保存窗口类型2（注意不是另存为窗口），特点：只有2个选项：是（默认，回车）、否或者取消（esc）
GroupAdd,savebox2, Microsoft Excel ahk_class #32770,要删除的工作表中可能存在数据 ;…………………excel 2010版删除工作表窗口
GroupAdd,savebox2, Microsoft Office Excel ahk_class #32770,要删除的工作表中可能存在数据 ;…………………excel 07版删除工作表窗口
GroupAdd,savebox2, 快捷键.ahk ahk_class #32770    ;………………………………本脚本弹出的某些提示窗口
GroupAdd,savebox2, ahk_class #32770,&Copy to clipboard    ;………………………irfanview图片浏览器的exif窗口
GroupAdd,savebox2, IrfanView - 图像属性 ahk_class #32770    ;………………………irfanview图片浏览器的图片属性窗口
GroupAdd,savebox2, 退出确认 ahk_class #32770    ;……………………通达信退出窗口
GroupAdd,savebox2, 盘后数据下载 ahk_class #32770    ;……………………通达信数据下载窗口
GroupAdd,savebox2, Notepad2-mod ahk_class #32770    ;……………………notepad2 mod搜索到底部后弹出的窗口（循环搜索）

;启动时需默认英文输入状态的窗口
GroupAdd English ahk_class ShImgVw:CPreviewWnd  ;图片浏览器
GroupAdd English ahk_class IrfanView ;……………IrfanView图片查看器
GroupAdd English Total Commander ahk_class TOverWriteForm ;……………………tc覆盖粘贴时弹出的窗口
GroupAdd English ahk_class TdxW_MainFrame_Class ;……………………通达信
;GroupAdd,English, ahk_class Shell_TrayWnd ;……………………任务栏
GroupAdd,English, QQ影音 ahk_class QQPlayer Window ;……………………QQ影音
GroupAdd,English, 同花顺 ahk_exe hexin.exe
GroupAdd,English, ahk_class uie_eslyric_desktop_wnd_class ;……………………foobar2000桌面歌词界面
GroupAdd,English, ahk_class SUMATRA_PDF_FRAME ;……………………SumatraPDF阅读器
;广告窗口，暂与English并列
GroupAdd,English, TeamViewer ahk_class HTML Application Host Window Class  ;………………TeamViewer广告
GroupAdd,English, 搜狐影音 ahk_class SohuWin  ;………………搜狐影音广告
;}

; 键位状态设置
SetCapsLockState "AlwaysOff"  ; 除非特定场景需要，否则保持CapsLock关闭
SetKeyDelay TICKRATE          ; 统一按键延迟，考虑根据需要调整